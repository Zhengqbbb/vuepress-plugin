# shellcheck shell=bash disable=SC1091,SC2034 #xsh

# Section: Arg
xrc ui
WORK_DIR="$(x wsroot)"
# EndSection

# Section: Main
use_npm_verison() {
	[ -z "$(command -v nvm)" ] \
		&& printf "%s\n" "Not command nvm" \
		&& xrc install  \
		&& install nvm \
		&& return 1
	nvm use
}

if [ ! -d "$WORK_DIR/node_modules" ]; then
    use_npm_verison && yarn install && x build plugin
else
	case "${1:=repo}" in
		all)
			rm -rf "$WORK_DIR/node_modules" "$WORK_DIR/yarn.lock"
			use_npm_verison && yarn install && x build plugin
		;;
		none)
			:
		;;
		plugin)
			shift; use_npm_verison && yarn add -D -W "$@"
		;;
		update|*)
			ui prompt "$(ui bold green 'Is need to remove node_modules (Y/n)')" _IS_NEED
			if [ -z "$_IS_NEED" ] || [ "$_IS_NEED" = 'y' ] || [ "$_IS_NEED" = 'Y' ] ;then
				rm -rf "$WORK_DIR/node_modules"
				use_npm_verison && yarn install && x build plugin
			else
				use_npm_verison && yarn install && x build plugin
			fi
		;;
	esac
fi
# EndSection

# Section: Advise
if ___x_cmd_is_suitable_advise_env; then
		# init is advise keyword
    x advise rm "install"
    advise "install" - <<A
{
    "all": "--- delete lock file adn reinstall all dependencies",
    "plugin": "--- yarn add dependencies",
    "update": "--- update all dependencies"
}
A
fi
# EndSection