# shellcheck shell=bash disable=SC2034 #xsh

# Section: Arg
WORK_DIR="$(x wsroot)"
GITEE_URL=gitee.com:AAAben/qbenben.git
GITHUB_URL=github.com:Zhengqbbb/zhengqbbb.github.io.git
BRANCH_NAME=gh-page
DIST_PATH="$WORK_DIR"/dist

page_deploy(){
    set -e
    [ -d "$DIST_PATH/.git" ] && rm -rf "$DIST_PATH/.git"
    git init
    git remote add origin git@"$1"
    git checkout -b $BRANCH_NAME
    git add -A
    git commit -m 'deploy'
    git push -f git@"$1" $BRANCH_NAME
    set +e
}

# Section: Main
if [ ! -d "$WORK_DIR/node_modules" ]; then
    yarn --frozen-lockfile
    xws build
else
    x build docs
fi
cd "$WORK_DIR"/dist || exit
# 如果是发布到自定义域名
echo 'www.qbenben.com' > CNAME
# page_deploy "$GITEE_URL"
page_deploy "$GITHUB_URL"
